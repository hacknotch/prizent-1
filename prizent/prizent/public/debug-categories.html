<!DOCTYPE html>
<html>
<head>
    <title>Debug Categories API</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Debug Categories API</h1>
    <button onclick="testDirectAPI()">Test Direct API (port 8080)</button>
    <button onclick="testProxyAPI()">Test Proxy API (port 3000)</button>
    <button onclick="testCurrentPageAPI()">Test from Current Page Context</button>
    <pre id="result"></pre>

    <script>
        function log(message, color = 'black') {
            const result = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            result.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            console.log(message);
        }

        async function testDirectAPI() {
            log("=== Testing Direct API (localhost:8080) ===");
            try {
                const response = await axios.get('http://localhost:8080/api/admin/categories', {
                    headers: { 'Content-Type': 'application/json' }
                });
                log("✅ Direct API SUCCESS!", 'green');
                log(`Status: ${response.status}`);
                log(`Data: ${JSON.stringify(response.data, null, 2)}`);
            } catch (error) {
                log("❌ Direct API ERROR:", 'red');
                log(`Error: ${error.message}`);
                if (error.response) {
                    log(`Status: ${error.response.status}`);
                    log(`Data: ${JSON.stringify(error.response.data, null, 2)}`);
                }
                log(`Full error: ${JSON.stringify(error, null, 2)}`);
            }
        }

        async function testProxyAPI() {
            log("=== Testing Proxy API (through React dev server) ===");
            try {
                const response = await axios.get('/api/admin/categories', {
                    headers: { 'Content-Type': 'application/json' }
                });
                log("✅ Proxy API SUCCESS!", 'green');
                log(`Status: ${response.status}`);
                log(`Data: ${JSON.stringify(response.data, null, 2)}`);
            } catch (error) {
                log("❌ Proxy API ERROR:", 'red');
                log(`Error: ${error.message}`);
                if (error.response) {
                    log(`Status: ${error.response.status}`);
                    log(`Data: ${JSON.stringify(error.response.data, null, 2)}`);
                }
                log(`Full error: ${JSON.stringify(error, null, 2)}`);
            }
        }

        async function testCurrentPageAPI() {
            log("=== Testing from Current Page Context ===");
            try {
                // Test with same config as React app
                const response = await fetch('/api/admin/categories', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                log(`Response status: ${response.status}`);
                log(`Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log("✅ Fetch API SUCCESS!", 'green');
                    log(`Data: ${JSON.stringify(data, null, 2)}`);
                } else {
                    const errorText = await response.text();
                    log("❌ Fetch API ERROR:", 'red');
                    log(`Error response: ${errorText}`);
                }
            } catch (error) {
                log("❌ Fetch API EXCEPTION:", 'red');
                log(`Error: ${error.message}`);
                log(`Full error: ${JSON.stringify(error, null, 2)}`);
            }
        }

        // Clear results
        document.getElementById('result').innerHTML = '';
        log("Debug page loaded. Click buttons to test APIs.");
    </script>
</body>
</html>